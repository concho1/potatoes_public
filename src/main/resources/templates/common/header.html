<header th:fragment="header-fragment" id="header" class="header fixed-top d-flex align-items-center">
    <script src="https://code.jquery.com/jquery-3.7.1.js" integrity="sha256-eKhayi8LEQwp4NKxN+CfCh+3qOVUtJn3QNZ0TciWLP4=" crossorigin="anonymous"></script>
    <script>
        $(document).ready(function () {
            $('#chatLink').click(function (event) {
                event.preventDefault();  // 기본 링크 동작을 막음
                var recipient = prompt("메시지를 보낼 사람의 닉네임을 입력하세요:");
                if (recipient) {
                    window.location.href = '/chat-to/' + recipient;
                }
            });
        });
    </script>
    <div class="d-flex align-items-center justify-content-between">
        <a th:href="@{/concho/main}" class="logo d-flex align-items-center">
            <img th:src="@{/assets/img/logo.png}"  alt="">
            <span class="d-none d-lg-block my-font"
                  style="font-family: 'Jua', sans-serif;font-weight: 400;font-style: normal;">
                    &nbsp; 찾아감!
                </span>
        </a>
        <i class="bi bi-list toggle-sidebar-btn"></i>
    </div><!-- End Logo -->

    <nav class="header-nav ms-auto">
        <ul class="d-flex align-items-center">
            <li class="nav-item dropdown">

                <a class="nav-link nav-icon" href="#" data-bs-toggle="dropdown">
                    <i class="bi bi-bell"></i>
                    <th:block th:if="${session.roomMap != null && !session.roomMap.isEmpty()}">
                        <span class="badge bg-primary badge-number" th:text="${session.roomMap.keySet().size()}"></span>
                    </th:block>
                    <th:block th:if="${session.roomMap == null || session.roomMap.isEmpty()}">
                        <span class="badge bg-primary badge-number">0</span>
                    </th:block>
                </a><!-- End Messages Icon -->

                <ul class="dropdown-menu dropdown-menu-end dropdown-menu-arrow messages">
                    <th:block th:if="${session.roomMap != null && !session.roomMap.isEmpty()}">
                        <li class="dropdown-header" th:text="|${session.roomMap.keySet().size()} 개의 메시지가 있습니다. |">
                            <a href="#"><span class="badge rounded-pill bg-primary p-2 ms-2">모두 보기</span></a>
                        </li>
                    </th:block>
                    <th:block th:if="${session.roomMap == null || session.roomMap.isEmpty()}">
                        <li class="dropdown-header">
                            메시지가 없습니다.
                        </li>
                    </th:block>
                    <li>
                        <hr class="dropdown-divider">
                    </li>
                    <th:block th:if="${session.roomMap != null && !session.roomMap.isEmpty()}">
                        <th:block th:each="roomName : ${session.roomMap.keySet()}">
                            <li class="message-item">
                                <a th:href="|/chat-to/${session.roomMap.get(roomName).getSendUserNickname()}|">
                                    <img th:src="@{${session.userImgRoomNameMap.get(roomName)}}" alt="" class="rounded-circle">
                                    <!-- userImgUrl-->
                                    <div>
                                        <h4 th:text="${session.roomMap.get(roomName).getSendUserNickname()}"></h4>
                                        <p th:text="${session.roomMap.get(roomName).getCont()}"></p>
                                        <p th:text="${session.roomMap.get(roomName).getCreatedAt().toString().substring(5,16)}"></p>
                                    </div>
                                    <!--
                                    -->
                                </a>
                            </li>
                            <li>
                                <hr class="dropdown-divider">
                            </li>
                        </th:block>
                    </th:block>

                </ul><!-- End Messages Dropdown Items -->

            </li><!-- End Messages Nav -->


            <li class="nav-item dropdown">

                <a id="chatLink" class="nav-link nav-icon"  href="#" data-bs-toggle="dropdown">
                    <i class="bi bi-chat-left-text"></i>
                </a><!-- End Messages Icon -->
            </li><!-- End Messages Nav -->


            <li class="nav-item dropdown pe-3">

                <a  class="nav-link nav-profile d-flex align-items-center pe-0" href="#" data-bs-toggle="dropdown">
                    <img style="width: 2rem; height: 2rem" th:if="${session.userImgUrl == null}" th:src="@{/assets/img/profile-img.jpg}" alt="Profile" class="rounded-circle">
                    <img style="width: 2rem; height: 2rem" th:if="${session.userImgUrl != null}" th:src="${session.userImgUrl}" alt="Profile" class="rounded-circle">
                    <span th:if="${session.userNickname == null}" class="d-none d-md-block dropdown-toggle ps-2">비회원</span>
                    <span th:if="${session.userNickname != null}" th:text="${session.userNickname}" class="d-none d-md-block dropdown-toggle ps-2"></span>
                </a><!-- End Profile Iamge Icon -->

                <ul class="dropdown-menu dropdown-menu-end dropdown-menu-arrow profile">
                    <li class="dropdown-header">
                        <img style="width: 60px; height: 60px" th:if="${session.userImgUrl == null}" th:src="@{/assets/img/profile-img.jpg}" alt="Profile" class="rounded-circle">
                        <img style="width: 60px; height: 60px" th:if="${session.userImgUrl != null}" th:src="${session.userImgUrl}" alt="Profile" class="rounded-circle">
                        <h6>
                            <span th:if="${session.userNickname == null}" >비회원</span>
                            <span th:if="${session.userNickname != null}" th:text="${session.userNickname}"></span>
                        </h6>
                    </li>
                    <li>
                        <hr class="dropdown-divider">
                    </li>

                    <li>
                        <a class="dropdown-item d-flex align-items-center" th:href="@{/myPage}">
                            <i class="bi bi-person"></i>
                            <span>마이페이지</span>
                        </a>
                    </li>
                    <li>
                        <hr class="dropdown-divider">
                    </li>

                    <li>
                        <a class="dropdown-item d-flex align-items-center" th:href="@{#}">
                            <i class="bi bi-question-circle"></i>
                            <span>문의하기</span>
                        </a>
                    </li>
                    <li>
                        <hr class="dropdown-divider">
                    </li>

                    <li th:if="${session.userId != null}">
                        <a class="dropdown-item d-flex align-items-center" th:href="@{/logout}">
                            <i class="bi bi-box-arrow-right"></i>
                            <span>로그아웃</span>
                        </a>
                    </li>

                    <li th:if="${session.userId == null}">
                        <a class="dropdown-item d-flex align-items-center" th:href="@{/login}">
                            <i class="bi bi-box-arrow-right"></i>
                            <span>로그인</span>
                        </a>
                    </li>

                </ul><!-- End Profile Dropdown Items -->
            </li><!-- End Profile Nav -->

        </ul>
    </nav><!-- End Icons Navigation -->

</header>